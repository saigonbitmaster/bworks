{
  "name": "Client",
  "base": "PersistedModel",
  "idInjection": false,
  "options": {
    "validateUpsert": true
  },
  "indexes": {
    "fullText": {
      "keys": {
        "name": "text",
        "serial": "text",
        "qrCode": "text",
        "contractNo": "text",
        "formattedAddress": "text",
        "buyerIdNo": "text",
        "code": "text"
      },
      "options": {
        "default_language": "french",
        "weights": {
          "name": 10,
          "serial": 8,
          "qrCode": 20,
          "contractNo": 20,
          "formattedAddress": 6,
          "buyerIdNo": 8,
          "code": 20
        }
      }
    }
  },
  "properties": {
    "code": {
      "type": "string",
      "required": true,
      "default": "",
      "index": true
    },
    "name": {
      "type": "string",
      "required": true,
      "index": true
    },
    "address": {
      "type": "string"
    },
    "formattedAddress": {
      "type": "string",
      "description": "combine all address components"
    },
    "position": {
      "type": "geopoint",
      "index": true
    },
    "phoneNumber": {
      "type": "string",
      "index": true
    },
    "taxNo": {
      "type": "string",
      "index": true
    },
    "type": {
      "type": "string",
      "enum": [
        "RESIDENT",
        "ORGANIZATION",
        "INDUSTRY",
        "SERVICE"
      ],
      "index": true
    },
    "status": {
      "type": "string",
      "enum": [
        "CONTRACT_SIGNED",
        "INSTALL_WAITING",
        "ACTIVE",
        "PAUSE",
        "STOP",
        "NEW"
      ],
      "default": "CONTRACT_SIGNED",
      "index": true
    },
    "familyCount": {
      "type": "number",
      "required": true
    },
    "memberCount": {
      "type": "number",
      "required": true,
      "index": true
    },
    "contractNo": {
      "type": "string",
      "index": true
    },
    "contractStatus": {
      "type": "string",
      "enum": [
        "ACTIVE",
        "STOP"
      ],
      "default": "ACTIVE",
      "index": true
    },
    "contractDate": {
      "type": "date",
      "index": true
    },
    "lastMeterNumber": {
      "type": "number",
      "description": "chi so dong ho cuoi cung",
      "default": null,
      "index": true
    },
    "lastTimeMeterNumberUpdate": {
      "type": "date",
      "description": "thoi gian cuoi cung update chi so dong",
      "default": null,
      "index": true
    },
    "lastPay": {
      "type": "date",
      "index": true
    },
    "buyerIdType": {
      "type": "string",
      "enum": [
        "1",
        "2",
        "3"
      ],
      "max": 1,
      "index": true
    },
    "buyerIdNo": {
      "type": "string",
      "max": 20,
      "index": true
    },
    "buyerFaxNumber": {
      "type": "string",
      "max": 20
    },
    "buyerEmail": {
      "type": "string",
      "max": 50,
      "index": true
    },
    "buyerBankName": {
      "type": "string",
      "max": 256
    },
    "buyerBankAccount": {
      "type": "string",
      "max": 20
    },
    "startMeterDate": {
      "type": "date",
      "index": true,
      "default": null
    },
    "termInvoice": {
      "type": "date"
    },
    "termMeterNumber": {
      "type": "date",
      "index": true
    },
    "activeRequests": {
      "type": [
        "objectid"
      ],
      "index": true
    },
    "serial": {
      "type": "string"
    }
  },
  "validations": [],
  "relations": {
    "province": {
      "type": "belongsTo",
      "model": "GeoProvince"
    },
    "district": {
      "type": "belongsTo",
      "model": "GeoDistrict"
    },
    "ward": {
      "type": "belongsTo",
      "model": "GeoWard"
    },
    "quarter": {
      "type": "belongsTo",
      "model": "GeoQuarter"
    },
    "provider": {
      "type": "belongsTo",
      "model": "WaterProvider"
    },
    "meter": {
      "type": "belongsTo",
      "model": "ClientMeter",
      "foreignKey": "meterId"
    },
    "formula": {
      "type": "belongsTo",
      "model": "Formula",
      "foreignKey": "formulaId"
    },
    "dma": {
      "type": "belongsTo",
      "model": "Dma",
      "foreignKey": "dmaId"
    },
    "register": {
      "type": "belongsTo",
      "model": "ClientRegister",
      "foreignKey": "registerId"
    },
    "meterNumbers": {
      "type": "hasMany",
      "model": "ClientMeterNumber",
      "foreignKey": "clientId"
    },
    "requests": {
      "type": "hasMany",
      "model": "ClientRequest",
      "foreignKey": "clientId"
    },
    "factory": {
      "type": "belongsTo",
      "model": "Factory",
      "foreignKey": "factoryId"
    }
  },
  "acls": [
    {
      "property": "editClient",
      "accessType": "*",
      "principalType": "ROLE",
      "principalId": "$authenticated",
      "permission": "ALLOW"
    },
    {
      "property": "getClientById",
      "accessType": "*",
      "principalType": "ROLE",
      "principalId": "$authenticated",
      "permission": "ALLOW"
    },
    {
      "property": "invoiceNotice",
      "accessType": "*",
      "principalType": "ROLE",
      "principalId": "$authenticated",
      "permission": "ALLOW"
    },
    {
      "property": "invoice",
      "accessType": "*",
      "principalType": "ROLE",
      "principalId": "$authenticated",
      "permission": "ALLOW"
    }
  ],
  "methods": {}
}